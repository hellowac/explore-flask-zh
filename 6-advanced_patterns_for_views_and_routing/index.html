
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>关于视图和路由的进阶技巧 - 《explore flask》中文翻译</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="《explore flask》中文翻译" class="md-header__button md-logo" aria-label="《explore flask》中文翻译" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            《explore flask》中文翻译
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              关于视图和路由的进阶技巧
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="《explore flask》中文翻译" class="md-nav__button md-logo" aria-label="《explore flask》中文翻译" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    《explore flask》中文翻译
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        README
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cover/" class="md-nav__link">
        封面
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../1-introduction/" class="md-nav__link">
        前言
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2-coding_conventions/" class="md-nav__link">
        代码约定
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../3-environment/" class="md-nav__link">
        环境
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../4-organizing_your_project/" class="md-nav__link">
        组织你的项目
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../5-configuration/" class="md-nav__link">
        配置
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          关于视图和路由的进阶技巧
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        关于视图和路由的进阶技巧
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    视图装饰器
  </a>
  
    <nav class="md-nav" aria-label="视图装饰器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    认证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    自定义装饰器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    URL 转换器
  </a>
  
    <nav class="md-nav" aria-label="URL 转换器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    内建转换器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    自定义转换器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../7-blueprints/" class="md-nav__link">
        蓝图
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../8-templates/" class="md-nav__link">
        模板
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../9-static_files/" class="md-nav__link">
        静态文件
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../10-storing-data/" class="md-nav__link">
        存储
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../11-handling_forms/" class="md-nav__link">
        处理表单
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../12-handling_users/" class="md-nav__link">
        用户管理的规范
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../13-deployment/" class="md-nav__link">
        部署
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../14-conclusion/" class="md-nav__link">
        结语
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    视图装饰器
  </a>
  
    <nav class="md-nav" aria-label="视图装饰器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    认证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    自定义装饰器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    URL 转换器
  </a>
  
    <nav class="md-nav" aria-label="URL 转换器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    内建转换器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    自定义转换器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<p><img alt="关于视图和路由的进阶技巧" src="../images/views.png" /></p>
<p>原文: <a href="http://exploreflask.com/en/latest/views.html">http://exploreflask.com/en/latest/views.html</a></p>
<h1 id="_1">关于视图和路由的进阶技巧</h1>
<h2 id="_2">视图装饰器</h2>
<p>Python 装饰器让我们可以用其他函数包装特定函数。
当一个函数被一个装饰器“装饰”时，那个装饰器会被调用，接着会做额外的工作，修改变量，调用原来的那个函数。我们可以把我们想要重用的代码作为装饰器来包装一系列视图。</p>
<p>装饰器的语法看上去像这样:</p>
<pre><code class="language-python">@decorator_function
def decorated():
    pass
</code></pre>
<p>如果你看过 Flask 入门指南，那么对这个语法应该不感到陌生。<code>@app.route</code> 正是用于在 Flask 应用中给视图函数设定路由 URL 的装饰器。</p>
<p>让我们看一下在你的 Flask 应用中用得上的一些别的装饰器。</p>
<h3 id="_3">认证</h3>
<p>Flask-Login 使得用户认证系统的实现不再困难。
除了处理用户认证的细节之外，Flask-Login 允许我们使用 <code>@login_required</code> 这个装饰器来验证用户对某些资源的访问权限。</p>
<p>下面是从一个用到 Flask-Login 和 <code>@login_required</code> 装饰器的一个示范应用中获取的例子:</p>
<pre><code>from flask import render_template
from flask_login import login_required, current_user


@app.route('/')
def index():
    return render_template(&quot;index.html&quot;)

@app.route('/dashboard')
@login_required
def account():
    return render_template(&quot;account.html&quot;)
</code></pre>
<blockquote>
<p><strong>注意</strong>
<code>@app.route</code>必须是最外面的视图装饰器。</p>
</blockquote>
<p>只有已经验证的用户能够接触到 <em>/dashboard</em> 路由。你可以配置 Flask-Login 来重定向未验证用户到登录页面，返回 HTTP 401 状态码或别的你乐意的事。</p>
<blockquote>
<p><strong>参见</strong>
通过<a href="http://flask-login.readthedocs.org/en/latest/">官方文档</a>可以读到更多关于Flask-Login的内容</p>
</blockquote>
<h3 id="_4">缓存</h3>
<p>意淫一下，假如你的应用突然有一天在微博/朋友圈或网上别的地方火了。
于是秒秒钟会有成千上万的请求涌向你的应用。你的主页在每个请求中都要从数据库跑上一大趟，结果海量的请求导致网站慢得像教务系统一样。
你能做什么来加速这一过程，以免用户以为你的应用挂掉了？</p>
<p>答案不止一个，不过就本章主旨而言，标准答案是实现缓存。
特别的，我们将要用到<a href="http://pythonhosted.org/Flask-Cache/">Flask-Cache</a>拓展。这个拓展给我们提供一个可以用来缓存某个响应一段时间的装饰器。</p>
<p>你可以将 Flask-Cache 配置成跟你想用的后台缓存一起使用。一个普遍的选择是<a href="http://redis.io/">Redis</a>，一个容易配置和使用的软件。
假设 Flask-Cache 已经配置好了，下面是我们的被装饰的视图的例子:</p>
<pre><code>from flask_cache import Cache
from flask import Flask

app = Flask()

# 通过这个方式获取相关配置
cache = Cache(app)

@app.route('/')
@cache.cached(timeout=60)
def index():
    [...] # 进行一些数据库调用来获取所需信息
    return render_template(
        'index.html',
        latest_posts=latest_posts,
        recent_users=recent_users,
        recent_photos=recent_photos
    )

</code></pre>
<p>现在这个函数将会在每 60 秒最多运行一次。响应的结果会被保存在缓存中，并可以让期间的每一个请求获取。</p>
<blockquote>
<p><strong>注意</strong>
Flask-Cache同时允许我们<strong>记住</strong>函数 - 或缓存通过给定的参数调用的某个函数。你甚至可以缓存过于复杂的Jinja2模板片段!</p>
</blockquote>
<h3 id="_5">自定义装饰器</h3>
<p>在这个例子中，让我们假设我们有一个应用，每个月要求用户定期付费。如果一个用户的账户已经过期，我们要重定向他们到账单页面，并告知其悲伤的现实。</p>
<p>myapp/util.py</p>
<pre><code>from functools import wraps
from datetime import datetime

from flask import flash, redirect, url_for

from flask_login import current_user

def check_expired(func):
    @wraps(func)
    def decorated_function(*args, **kwargs):
        if datetime.utcnow() &gt; current_user.account_expires:
            flash(&quot;Your account has expired. Please update your billing information.&quot;)
            return redirect(url_for('account_billing'))
        return func(*args, **kwargs)

    return decorated_function
</code></pre>
<ol>
<li>当用 <code>@check_expired</code> 装饰一个函数时，<code>check_expired()</code> 被调用，被装饰的函数作为一个参数被传递进来。</li>
<li><code>@wraps</code> 是一个装饰器，告知 Python 函数 <code>decorated_function()</code> 包装了视图函数 <code>func()</code>。严格来说这不是必须的，但是这么做会使得装饰函数更加自然一些，更有利于文档和调试。</li>
<li><code>decorated_function</code> 将截取原本传递给视图函数 <code>func()</code> 的 args 和 kwargs。在这里我们检查用户的账户是否过期。如果是，我们将闪烁一则信息，并重定向到账单页面。</li>
<li>既然已经处理好自己的事情，我们把原来的参数交由视图函数 <code>func()</code> 去继续执行。</li>
</ol>
<p>位于最顶部的装饰器将最先运行，然后调用下一个函数：一个视图函数或下一个装饰器。装饰器语法只是一个语法糖而已。</p>
<pre><code class="language-python"># 这样
@foo
@bar
def one():
    pass

r1 = one()
</code></pre>
<pre><code class="language-python"># 等同于这样:
def two():
    pass
two = foo(bar(two))
r2 = two()

r1 == r2 # True
</code></pre>
<p>下面这个例子用到了我们自定义的装饰器和来自 Flask-login 拓展的 <code>@login_required</code> 装饰器。我们可以将多个装饰器堆成栈来一起使用。</p>
<p>myapp/views.py</p>
<pre><code>from flask import render_template

from flask_login import login_required

from . import app
from .util import check_expired

@app.route('/use_app')
@login_required
@check_expired
def use_app():
    &quot;&quot;&quot;欢迎光临&quot;&quot;&quot;

    return render_template('use_app.html')

@app.route('/account/billing')
@login_required
def account_billing():
    &quot;&quot;&quot;拿账单来&quot;&quot;&quot;
    # [...]
    return render_template('account/billing.html')
</code></pre>
<p>当一个用户试图访问 <em>/use_app</em> 时，<code>check_expired()</code> 将在执行视图函数之前确保相关的账户资料不会泄漏。</p>
<blockquote>
<p>参见
在Python文档中可以读到更多关于<code>wraps()</code>的内容：<a href="http://docs.python.org/2/library/functools.html#functools.wraps">http://docs.python.org/2/library/functools.html#functools.wraps</a></p>
</blockquote>
<h2 id="url">URL 转换器</h2>
<h3 id="_6">内建转换器</h3>
<p>当你在 Flask 中定义一个路由时，你可以将指定的一部分转换成 Python 变量并传递给视图函数。</p>
<pre><code>@app.route('/user/&lt;username&gt;')
def profile(username):
    pass
</code></pre>
<p>在 URL 中作为<username>的那一部分内容将作为 <code>username</code> 参数传递给视图函数。你也可以指定一个转换器过滤出特定的类型。</p>
<pre><code>@app.route('/user/id/&lt;int:user_id&gt;')
def profile(user_id):
    pass
</code></pre>
<p>在这个代码块中，<a href="http://myapp.com/user/id/tomato">http://myapp.com/user/id/tomato</a> 这个 URL 会返回一个 404 状态码 -- 此物无处觅。
这是因为 URL 中预期是整数的部分却遇到了一串字符串。</p>
<p>我们可以有另外一个接受一个字符串的视图函数。<em>/usr/id/tomato/</em> 将调用它，而前一个函数只会被 <em>/user/id/124</em> 所调用。</p>
<p>下面是来自 Flask 文档的关于默认转换器的表格:</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>接受任何没有斜杠<code>/</code>的文本（默认）</td>
</tr>
<tr>
<td>int</td>
<td>接受整数</td>
</tr>
<tr>
<td>float</td>
<td>类似于<code>int</code>，但是接受的是浮点数</td>
</tr>
<tr>
<td>path</td>
<td>类似于<code>string</code>，但是接受斜杠<code>/</code></td>
</tr>
</tbody>
</table>
<h3 id="_7">自定义转换器</h3>
<p>我们也可以按照自己的需求打造自定义的转换器。
Reddit - 一个知名的链接分享网站 - 用户在此可以创建和管理基于主题和链接分享的社区。
比如 <code>/r/python</code> 和 <code>/r/flask</code>，分别由 URL <code>reddit.com/r/python</code> 和 <code>reddit.com/r/flask</code> 表示。
Reddit 有一个有趣的特性是，通过在 URL 中用一个 <code>+</code> 隔开各个社区名，你可以同时看到来自多个社区的帖子。比如 <code>reddit.com/r/python+flask</code>。</p>
<p>我们可以使用一个自定义转换器来实现这种特性。
我们可以接受由加号隔离开来的任意数目参数，通过我们的 ListConverter 转换成一个列表，并传递给视图函数。</p>
<p>util.py</p>
<pre><code class="language-python">from werkzeug.routing import BaseConverter

class ListConverter(BaseConverter):

    def to_python(self, value):
        return value.split('+')

    def to_url(self, values):
        return '+'.join(BaseConverter.to_url(value)
                        for value in values)
</code></pre>
<p>我们需要定义两个方法:<code>to_python()</code> 和 <code>to_url()</code>。
一如其名，<code>to_python()</code> 用于转换路径成一个 Python 对象，并传递给视图函数。而 <code>to_url()</code> 被 <code>url_for()</code> 调用，来转换参数成为符合 URL 的形式。</p>
<p>为了使用我们的 ListConverter，我们首先得将它的存在告知 Flask。</p>
<p>/myapp/__init__.py</p>
<pre><code>from flask import Flask

app = Flask(__name__)

from .util import ListConverter

app.url_map.converters['list'] = ListConverter
</code></pre>
<blockquote>
<p><strong>注意</strong>
假如你的util模块有一行<code>from . import app</code>，那么有可能陷入循环import的问题。这就是为什么我等到app初始化之后才import ListConverter。</p>
</blockquote>
<p>现在我们可以一如使用内建转换器一样使用我们的转换器。我们在字典中指定它的键为 "list"，所以我们可以在 <code>@app.route()</code> 中这样使用:</p>
<p>views.py</p>
<pre><code class="language-python">from . import app

@app.route('/r/&lt;list:subreddits&gt;')
def subreddit_home(subreddits):
    &quot;&quot;&quot;显示给定subreddits里的所有帖子&quot;&quot;&quot;
    posts = []
    for subreddit in subreddits:
        posts.extend(subreddit.posts)

    return render_template('/r/index.html', posts=posts)
</code></pre>
<p>这应该会像 Reddit 的子社区系统一样工作。这样的方法可以用来实现你能想到的 URL 转换器。</p>
<h2 id="_8">总结</h2>
<ul>
<li>Custom URL converters can be a great way to implement creative features involving URL’s.</li>
<li>来自 Flask-Login 的 <code>@login_required</code> 装饰器可以帮助你限制验证用户对视图的访问。</li>
<li>Flask-Cache 插件为你提供一组装饰器来实现多种方式的缓存。</li>
<li>我们可以开发自定义视图装饰器来帮助我们组织自己的代码，并坚守 DRY(Don't Repeat Yourself 不重复你自己)原则。</li>
<li>自定义的 URL 转换器将会让你很嗨地玩转 URL。</li>
</ul>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
      
        
        <a href="../5-configuration/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 配置" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              配置
            </div>
          </div>
        </a>
      
      
        
        <a href="../7-blueprints/" class="md-footer__link md-footer__link--next" aria-label="下一页: 蓝图" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              蓝图
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>